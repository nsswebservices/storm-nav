!function(t,e){"object"==typeof exports?module.exports=e():t.StormNav=e()}(this,function(){"use strict";function t(t,e){var i=document.querySelector(t);return 0===i.length||i.length>1?void console.warn("Nav element must match a single DOM node"):Object.assign(Object.create(n),{DOMElement:i,settings:Object.assign({},s,e)}).init()}var e={RETURN:13,TAB:9},i=["click","keydown","touchstart"],s={triggerSelector:".js-nav-trigger",targetSelector:".js-nav-target",closeBtnSelector:".js-nav-close",currentClass:"active",active:null},n={init:function(){this.triggers=[].slice.call(document.querySelectorAll(this.settings.triggerSelector)),this.targets=[].slice.call(document.querySelectorAll(this.settings.targetSelector)),this.nav={},this.targetsBySection={},this.triggersBySection={},this.current=this.settings.active,this.targets.forEach(function(t){this.targetsBySection[t.getAttribute("id")]=t}.bind(this));for(var t in this.targetsBySection)this.targetsBySection.hasOwnProperty(t)&&(this.triggersBySection[t]=this.triggers.filter(function(e){return(e.getAttribute("href")&&e.getAttribute("href").substr(1)||e.parentNode.getAttribute("id"))===t}.bind(this)));return this.closeBtn=document.querySelector(this.settings.closeBtnSelector),this.initAria(),this.initTriggers(),this.initCloseBtn(),this},initAria:function(){return this.triggers.forEach(function(t){STORM.UTILS.attributelist.set(t,{role:"tab",tabIndex:0,"aria-expanded":!1,"aria-selected":!1,"aria-controls":t.getAttribute("href")?t.getAttribute("href").substr(1):t.parentNode.getAttribute("id")})}),this.targets.forEach(function(t){STORM.UTILS.attributelist.set(t,{role:"tabpanel","aria-hidden":!0,tabIndex:"-1"})}),this},initCloseBtn:function(){i.forEach(function(t){this.closeBtn.addEventListener(t,function(t){t.stopImmediatePropagation(),null!==this.current&&this.toggle(this.current)}.bind(this),!1)}.bind(this))},initTriggers:function(t){var s=function(t,s){i.forEach(function(i){t.addEventListener(i,function(t){t.keyCode&&t.keyCode===e.TAB||t.keyCode&&t.keyCode!==e.RETURN||(t.preventDefault(),this.toggle(s))}.bind(this),!1)}.bind(this))}.bind(this);for(var n in this.triggersBySection)this.triggersBySection.hasOwnProperty(n)&&this.triggersBySection[n].forEach(function(t){s(t,n)}.bind(this))},toggle:function(t){return null===this.current?(this.changeTab("open",t),this.current=t,this):this.current===t?(this.changeTab("close",t),this.current=null,this):(this.changeTab("close",this.current).changeTab("open",t),this.current=t,this)},changeTab:function(t,e){var i={open:{classlist:"add",tabIndex:{target:this.targetsBySection[e],value:"0"}},close:{classlist:"remove",tabIndex:{target:this.targetsBySection[e],value:"-1"}}};return this.triggersBySection[e].forEach(function(e){console.log(e),e.classList[i[t].classlist](this.settings.currentClass),STORM.UTILS.attributelist.toggle(e,["aria-selected","aria-expanded"])}.bind(this)),this.targetsBySection[e].classList[i[t].classlist](this.settings.currentClass),STORM.UTILS.attributelist.toggle(this.targetsBySection[e],"aria-hidden"),STORM.UTILS.attributelist.set(i[t].tabIndex.target,{tabIndex:i[t].tabIndex.value}),this}};return{init:t}});